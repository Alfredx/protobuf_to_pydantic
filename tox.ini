[tox]
env_list =

    py37-grpcio-tools-v{1.40.0,1.51.1}-gen
    py37-grpcio-tools-v{1.40.0,1.51.1}-pydantic-v{1.10.7,2.0.3}-example
    py{310,39,38}-grpcio-tools-v{1.40.0,1.51.1}-pydantic-v{1.10.7,2.0.3}

[testenv]
deps =
    -r requirements-no-grpc-dev.txt

    grpcio-tools-v1.40.0: grpcio-tools==v1.40.0
    grpcio-tools-v1.51.0: grpcio-tools==v1.51.0
    pydantic-v1.10.7: pydantic==v1.10.7
    pydantic-v2.0.3: pydantic==v2.0.3

# In order for the script to work properly,
# you need to set the value of 'PYTHONPATH' to the current project path (
#   tox.ini which is located at the root path of the project
# )
setenv =
    PYTHONPATH = {toxinidir}

allowlist_externals = bash
commands =
    # gen protobuf code file
    py37-grpcio-tools-v1.40.0-gen: bash scripts/gen_proto.sh ./protobuf_to_pydantic/protos/old
    # py37-grpcio-tools-v1.51.1-gen: python -c "import sys; print(sys.path)"
    py37-grpcio-tools-v1.51.1-gen: bash scripts/gen_proto.sh ./protobuf_to_pydantic/protos

    # gen example code file
    py37-grpcio-tools-v{1.40.0,1.51.1}-pydantic-v{1.10.7,2.0.3}-example:  bash scripts/run_example_gen_code.sh

    # run unittest
    py{310,39,38}-grpcio-tools-v{1.40.0,1.51.1}: pytest --capture=no
